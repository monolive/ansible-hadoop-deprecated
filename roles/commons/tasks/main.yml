---
  - name : Copy HDP repo
    action: copy src=hdp-release-2.0.0.2-1.el6.noarch.rpm dest=/tmp/hdp-release-2.0.0.2-1.el6.noarch.rpm
  - name : install HDP repo
    action: shell yum localinstall -y /tmp/hdp-release-2.0.0.2-1.el6.noarch.rpm creates=/etc/yum.repos.d/hdp.repo
  - name : install hadoop
    action: yum name=hadoop,hadoop-hdfs,hadoop-libhdfs,hadoop-yarn,hadoop-mapreduce,hadoop-client,openssl state=latest
  - name : install compression library
    action: yum name=snappy,snappy-devel,lzo,lzo-devel,hadoop-lzo,hadoop-lzo-native state=latest
  - name : create log direcotory for HDFS
    file : path={{ item }} state=directory owner={{ hadoop.HDFS_USER }} group={{ hadoop.HADOOP_GROUP }} mode=0755 recurse=true
    with_items : hadoop.HDFS_LOG_DIR
  - name : create log direcotory for YARN
    file : path={{ item }} state=directory owner={{ hadoop.YARN_USER }} group={{ hadoop.HADOOP_GROUP }} mode=0755 recurse=true
    with_items : hadoop.YARN_LOG_DIR
  - name : create pid direcotory for HDFS
    file : path={{ item }} state=directory owner={{ hadoop.HDFS_USER }} group={{ hadoop.HADOOP_GROUP }} mode=0755 recurse=true
    with_items : hadoop.HDFS_PID_DIR
  - name : create pid direcotory for YARN
    file : path={{ item }} state=directory owner={{ hadoop.YARN_USER }} group={{ hadoop.HADOOP_GROUP }} mode=0755 recurse=true
    with_items : hadoop.YARN_PID_DIR
  - name : remove link /etc/hadoop/conf
    file : path=/etc/hadoop/conf state=absent
  - name : copy /etc/hadoop/conf
    local_action : command rsync -avz conf/ {{ insventory_hostname }}:/etc/hadoop/conf  
  - name : copy core-site.xml
    action : template src=core-site.xml.j2 dest=/etc/hadoop/conf/core-site.xml owner={{ hadoop.HDFS_USER }} group={{ hadoop.HADOOP_GROUP }}
  - name : copy hdfs-site.xml
    action : template src=hdfs-site.xml.j2 dest=/etc/hadoop/conf/hdfs-site.xml owner={{ hadoop.HDFS_USER }} group={{ hadoop.HADOOP_GROUP }}
  - name : copy yarn-site.xml
    action : template src=yarn-site.xml.j2 dest=/etc/hadoop/conf/yarn-site.xml owner={{ hadoop.HDFS_USER }} group={{ hadoop.HADOOP_GROUP }}
  - name : change permission on /etc/hadoop/conf
    file : path=/etc/hadoop/conf owner={{ hadoop.HDFS_USER }} group={{ hadoop.HADOOP_GROUP }} recurse=true mode=0755

